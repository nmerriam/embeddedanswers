---
layout: post
title:  "Tail-call optimization (1)"
author: nick
categories: [ C, tutorial ]
# tags: [red, yellow]
image: assets/images/hardTime.png
description: "Tail-call optimization (1)"
featured: true
hidden: true
comments: false
---

https://godbolt.org/z/KhW115Tc3

Tail-call optimization has some features that make it particularly
interesting to discuss. Most software developers
- have heard of tail-call optimization,
- do not really understand the benefits of tail-call optimization, and
- do not at all appreciate how widely it can be used.

The objective of these three articles on tail-call optimization is to
enable you to know when the benefits are relevant to your project
and to allow you to recognize opportunities for tail-call optimization.

## What is tail-call optimization?

Imagine we have three functions, `a`, `b` and `c`. The last action of
function `b` is to call function `c`. The un-optimized code for `b`
would jump to `c`, which would return to where `b`
would clean up its stack frame and return to `a`. With tail-call
optimization, `b` clean up its stack frame and _then_ jumps to `c`
with the Link Register (or equivalent) pointing back to `a`, so
that `c` will return not to `b` but to `a`.

Note that GCC refers to tail-call optimization as
[sibling call optimization](https://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html#index-foptimize-sibling-calls) because the behaviour is close to what you
would get if `b` and `c` were both called directly by (children of) `a`.

## What are the benefits of tail-call optimization?

There are two quite separate benefits of tail-call optimization.
1. The total stack memory is reduced, because the stack frame of `c`
   does not nest on top of the stack frame of `b`. The total reduces
   from `a` + `b` + `c` to `a` + max(`b`, `c`).
2. On return from `c`, rather than jumping from `c` to `b` and then
   from `b` to `a`, `c` returns directly to `a`. The benefit here is
   larger than you migh expect for saving one jump instruction because
   [jumps are relatively expensive for modern microprocessors](../singlepath-1/index.html).

